<!DOCTYPE html>
<html>
<head>
	<title>Barchart</title>
	<script src="d3.min.js" charset="utf-8"></script>
	<script type="text/javascript">
	  function GetUrlValue(VarSearch){
	  var SearchString = window.location.search.substring(1);
	  console.log(SearchString);
	  var VariableArray = SearchString.split('&');
	  console.log(VariableArray);
	  for(var i = 0; i < VariableArray.length; i++){
	    var KeyValuePair = VariableArray[i].split('=');
	    if(KeyValuePair[0] == VarSearch){
	      console.log(KeyValuePair[1]);
	      return KeyValuePair[1];
	      }
	    }
	  }



	</script>

	<style type="text/css">

		.axis path,
		.axis line {
			fill: none;
			stroke: black;
			shape-rendering: crispEdges;
		}

		.axis text {
			font-family: sans-serif;
			font-size: 11px;
		}


		
	</style>
</head>
<body>

	
	<script>

		//var dataset = [90, 20, 30, 22, 14, 0, 32, 65, 85, 34, 76, 56, 23, 12, 57, 44, 100];

		var color = d3.scale.category20();

		file = GetUrlValue("district");

		//d3.csv("data.csv", function(data){

			//console.log(dataset);

			var margin = {top:100, right: 50, bottom:100, left:100};
			var w = 800-margin.left - margin.right;
			var h = 600-margin.top - margin.bottom;

			var canvas = d3.select("body").append("svg")
							.attr("width", w + margin.left + margin.right)
							.attr("height",h + margin.top + margin.bottom)
							.append("g")
							.attr("transform","translate(" + margin.left + "," + margin.top +")");
							

			var xScale = d3.scale.ordinal()
							//.domain(d3.range(dataset.length))
							.rangeRoundBands([0,w], 0.2);

			var yScale = d3.scale.linear()
							//.domain([0,d3.max(dataset)])
							.range([h,0]);

			var xAxis = d3.svg.axis()
							.scale(xScale)
							.orient("bottom");

			var yAxis = d3.svg.axis()
							.scale(yScale)
							//.ticks(10)
							.orient("left");

			////////////////////////////////////////////////////////////////////////////////
			//Define sort order flag
			/*var sortOrder = false;
			

			console.log(dataset);
			//Define sort function
			var sortBars = function() {

				//Flip value of sortOrder
			   	sortOrder = !sortOrder;

				//Sort the rectangle
				canvas.selectAll("rect")
				   .sort(function(a, b) {
				   		if (sortOrder) {
					   		return d3.ascending(a, b);
				   		} else {
					   		return d3.descending(a, b);
				   		}
				   	})
				   .transition()
				   .delay(function(d, i) {
					   return i * 50;
				   })
				   .duration(1000)
				   .attr("x", function(d, i) {
				   		return xScale(i);
				   });

				// canvas.selectAll("text")

				
			};	///end sortbars

			////////////////////////////////////////////////////////////////////////////////

			var sortText = function() {

				
				//Sort the text
				canvas.selectAll(".text")
				   .sort(function(a, b) {
				   		if (sortOrder) {
					   		return d3.ascending(a, b);
				   		} else {
					   		return d3.descending(a, b);
				   		}
				   	})
				   .transition()
				   .delay(function(d, i) {
					   return i * 50;
				   })
				   .duration(1000)
				   .attr("x", function(d, i) {
				   		return xScale(i)+20;
				   });
			}


			*/

			d3.json(file + "district.json", function(error, data){
			    xScale.domain(data.map(function(d){return d.District;}));
			    yScale.domain([0,d3.max(data, function(d){return d.Cases;})]);

			canvas.selectAll("rect")
				.data(data).enter()
					.append("rect")

					.attr("x",function(d,i) { console.log(d); return xScale(d.District);
					})
					.attr("y", function (d){return yScale(d.Cases); })
					.attr("width", xScale.rangeBand())
					.attr("height",function (d) {console.log(d.Cases+"height"); return h-yScale(d.Cases); })
					//.style("fill",function(){return '#'+Math.floor(Math.random()*16777215).toString(16)})
					.attr("fill", function(d, i) {return color(i);})
					//.style("stroke","goldenrod")
					//.on("click", function() {sortBars();sortText();})
					.append("title")
					.text(function(d) {return d.District + " = " + d.Cases;});
					//.on("mouseover", function() { d3.select(this).style("fill", "red") });
					//.on("mouseout",  function() { d3.select(this).style("fill", "steelblue") });

			canvas.selectAll("rect")
			    //.data(data)
			    //.filter(function(d){ return typeof(d) == "string"; })
			    .style("cursor", "pointer")
			    .on("click", function(d){
			        document.location.href = "donut.html?district="+file +d.District;
			    });

			canvas.selectAll(".text")
				.data(data).enter()
					.append("text")
					.attr("class","text")
					.text(function(d) {	return d.Cases;  })
					   .attr("text-anchor", "middle")
					   .attr("x", function(d, i) {
					   		return xScale(d.District) + 25;})
					   .attr("y", function(d) { return yScale(d.Cases); })
					   .attr("font-family", "sans-serif")
					   .attr("font-size", "11px")
					   .attr("fill", "black");





			
			
			/*d3.select("p")
				    .on("click", function() {

				        //New random values for dataset

				        var numValues=dataset.length;
				        dataset = [];
				        for(var i = 0; i < numValues; i++)
				        	{
				        		var newNumber = Math.floor(Math.random() * 500);
				        		dataset.push(newNumber);
				        	}

				        yScale.domain([0,d3.max(dataset)]);

				        //Update all rects
				        canvas.selectAll("rect")
				           .data(dataset)
				           .transition()
				           .duration(1000)
				           .ease("bounce")
				           //.delay(function (d,i){return i*100})
				           .attr("y", function(d) {
				                return yScale(d);
				           })
				           .attr("height", function(d) {
				                return h - yScale(d);
				           });

				          // console.log(dataset);


				        //Update all text
				        canvas.selectAll("text")
						   .data(dataset)
						   .transition()
						   .duration(1000)
						   //.delay(function (d,i){return i*100})
						   .ease("bounce")
						   .text(function(d) {
						        return d;
						   })
						   .attr("x", function(d, i) {
						        return xScale(i) + xScale.rangeBand() / 2;
						   })
						   .attr("y", function(d) {
						        return yScale(d);
						   });

												
						//Update Y axis
						canvas.select(".y.axis")
					    	.transition()
					    	.duration(1000)
							.call(yAxis);

				    });*/

			canvas.append("g")
				.attr("class","x axis")
				.attr("transform","translate(0,"+ h + ")")
				.call(xAxis)
				.selectAll("text")
				.attr("dy",".15em")
				.attr("dx","-1em")
				.style("text-anchor","end")
				.attr("transform", function(d) {
                return "rotate(-65)" 
                });;

			canvas.append("g")
				.attr("class", "y axis")
				.call(yAxis)
				.append("text")
				.attr("transform","rotate(-90)")
				.attr("y",-60)
				.attr("x", -(h/2))
				.style("text-anchor","end")
				.text("Cases");


			
		});

	</script>
</body>
</html>